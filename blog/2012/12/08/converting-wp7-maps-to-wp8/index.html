
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Converting WP7 Maps to WP8 - Adam Speakman</title>
	<meta name="author" content="Adam">

	
	<meta name="description" content="After converting a Windows Phone 7 application (What&#8217;s Shaking, NZ?) to Windows Phone 8, I noticed a few deprecation warnings around the Maps &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Adam Speakman" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Adam Speakman</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
    <li><a href="/about">About</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
    <li><a href="/about">About</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:adamsp.github.com/speakman-website">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/adamsnz" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/adamsp" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:adamsp.github.com/speakman-website">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Converting WP7 Maps to WP8</h2>
	<div class="entry-content"><p>After <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj207030.aspx">converting</a> a Windows Phone 7 application (<a href="http://www.whatsshaking.co.nz">What&#8217;s Shaking, NZ?</a>) to Windows Phone 8, I noticed a few deprecation warnings around the Maps SDK. Converting the code to use the WP8 Maps SDK instead was fairly straightforward, but there were a few gotchas which I&#8217;ve covered in this post.</p>

<!--more-->


<p><em>Note: This post assumes you&#8217;ve already converted your Windows Phone 7 app to Windows Phone 8 and are wondering how to get rid of the deprecation messages.</em></p>

<p><em>It covers converting your code to use the new Pushpins (assuming you were using the default ones previously - though a glance over the Windows Phone 7 custom Pushpin image docs indicates to me that it should be fairly straightforward to port those over as well, after a read through this), as well as the changes required in XAML.</em></p>

<p><em>This post does not delve into displaying routes or providing directions, etc.</em></p>

<p><img class="bottom" src="/images/wp7-maps-to-wp8-maps/maps_deprecated.PNG" title="Deprecation Warnings" ></p>

<h3>Deleting old references</h3>

<p>First, delete both the old <a href="http://phone.codeplex.com/">Windows Phone Toolkit</a> if you were using it (I was using it for the <code>ToggleSwitch</code> control), and the <code>Microsoft.Controls.Phone.Maps</code> library from your project references. If some of your other code breaks (ie, the ToggleSwitch), don&#8217;t worry, we&#8217;re going to fix that later.</p>

<p>There will of course be references to these namespaces throughout your code. Feel free to delete these now, or as we go.</p>

<p>While you&#8217;re changing things in the Solution Explorer, you may as well update the WMAppManifest file - you need to include the new <code>IP_CAP_MAP</code> capability.</p>

<p><img class="bottom" src="/images/wp7-maps-to-wp8-maps/maps_app_manifest.PNG" title="WMAppManifest" ></p>

<h3>Changes to XAML</h3>

<p>Next, edit your XAML to reference the new xmlns declaration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xmlns:maps="clr-namespace:Microsoft.Phone.Maps.Controls;assembly=Microsoft.Phone.Maps"</span></code></pre></td></tr></table></div></figure>


<p>Now your <code>&lt;maps /&gt;</code> tag will probably show up with some blue squiggly underlines, previously I had this on one of my Map pages:</p>

<figure class='code'><figcaption><span>Old XAML</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;maps:Map</span> <span class="na">Grid.Row=</span><span class="s">&quot;1&quot;</span> <span class="na">Name=</span><span class="s">&quot;QuakeMap&quot;</span>
</span><span class='line'>    <span class="na">CredentialsProvider=</span><span class="s">&quot;your_maps_api_key_here&quot;</span>
</span><span class='line'>    <span class="na">ZoomLevel=</span><span class="s">&quot;5.3&quot;</span>
</span><span class='line'>    <span class="na">ZoomBarVisibility=</span><span class="s">&quot;Collapsed&quot;</span>
</span><span class='line'>    <span class="na">CopyrightVisibility=</span><span class="s">&quot;Collapsed&quot;</span>
</span><span class='line'>    <span class="na">LogoVisibility=</span><span class="s">&quot;Collapsed&quot;</span>
</span><span class='line'>    <span class="na">ScaleVisibility=</span><span class="s">&quot;Visible&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;maps:Map.Center&gt;</span>
</span><span class='line'>        <span class="nt">&lt;my:GeoCoordinate</span> <span class="na">Altitude=</span><span class="s">&quot;NaN&quot;</span>
</span><span class='line'>            <span class="na">Course=</span><span class="s">&quot;NaN&quot;</span>
</span><span class='line'>            <span class="na">HorizontalAccuracy=</span><span class="s">&quot;NaN&quot;</span>
</span><span class='line'>            <span class="na">Latitude=</span><span class="s">&quot;-41&quot;</span>
</span><span class='line'>            <span class="na">Longitude=</span><span class="s">&quot;173&quot;</span>
</span><span class='line'>            <span class="na">Speed=</span><span class="s">&quot;NaN&quot;</span>
</span><span class='line'>            <span class="na">VerticalAccuracy=</span><span class="s">&quot;NaN&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/maps:Map.Center&gt;</span>
</span><span class='line'><span class="nt">&lt;/maps:Map&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, my new XAML looks like this:</p>

<figure class='code'><figcaption><span>New XAML</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;maps:Map</span> <span class="na">Grid.Row=</span><span class="s">&quot;1&quot;</span> <span class="na">Name=</span><span class="s">&quot;QuakeMap&quot;</span>
</span><span class='line'>          <span class="na">ZoomLevel=</span><span class="s">&quot;5.3&quot;</span>
</span><span class='line'>          <span class="na">Center=</span><span class="s">&quot;-41, 173&quot;</span>
</span><span class='line'>          <span class="na">Loaded=</span><span class="s">&quot;QuakeMap_Loaded&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/maps:Map&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Much simpler, and all the previous properties I had marked as <code>Collapsed</code> are now collapsed by default (and no longer accessible).</p>

<h3>Pushpins</h3>

<p>Unfortunately the other part of the Maps that we&#8217;re talking about today (the Pushpins) has become <em>more</em> complicated, not less. Where previously you would simply create a <code>Pushpin</code> object, assign it a location and some content (and perhaps an event listener), and then add it via a <code>Map.Children.Add(pin)</code> call, now it&#8217;s not that simple.</p>

<p>To add the Pushpins, we now need to download and reference the <em>new</em> WPToolkit via NuGet. Go on, I&#8217;ll wait (the new one I used was published Oct 30 2012, was top result after searching for WPtoolkit). We need this for the Pushpins, as they are no longer included in the built-in Maps library (which is now located in the <code>Microsoft.Phone.Maps</code> assembly, as seen above). This should also fix any other issues you had where things from the previous Toolkit were no longer available (once you update your <code>using</code> statements).</p>

<p>Once that&#8217;s done, you can start fixing your existing Pushpin code. First, add a reference to the package you just downloaded:</p>

<figure class='code'><figcaption><span>New XAML</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>using Microsoft.Phone.Maps.Toolkit;
</span></code></pre></td></tr></table></div></figure>


<p>The next thing you&#8217;ll notice is that the <code>Location</code> property of the Pushpin no longer exists. It&#8217;s now called <code>GeoCoordinate</code>, that&#8217;s all. That should be all you need to change there:</p>

<figure class='code'><figcaption><span>Pushpin code</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">Pushpin</span> <span class="n">pin</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Pushpin</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">GeoCoordinate</span> <span class="p">=</span> <span class="n">quake</span><span class="p">.</span><span class="n">Location</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Content</span> <span class="p">=</span> <span class="n">quake</span><span class="p">.</span><span class="n">FormattedMagnitude</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now to add the pin, we need to:</p>

<ol>
<li>Create a <code>MapOverlay</code> object and add the pin to the overlay</li>
<li>Create a <code>MapLayer</code> object and add the overlay to the layer</li>
<li>Add the <code>MapLayer</code> to the <code>Layers</code> property of the map</li>
</ol>


<p>So let&#8217;s do that:</p>

<figure class='code'><figcaption><span>Pushpin code</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">MapOverlay</span> <span class="n">overlay</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MapOverlay</span><span class="p">();</span>
</span><span class='line'><span class="n">overlay</span><span class="p">.</span><span class="n">Content</span> <span class="p">=</span> <span class="n">pin</span><span class="p">;</span>
</span><span class='line'><span class="n">overlay</span><span class="p">.</span><span class="n">GeoCoordinate</span> <span class="p">=</span> <span class="n">quake</span><span class="p">.</span><span class="n">Location</span><span class="p">;</span>
</span><span class='line'><span class="n">overlay</span><span class="p">.</span><span class="n">PositionOrigin</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">MapLayer</span> <span class="n">layer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MapLayer</span><span class="p">();</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">overlay</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">QuakeMap</span><span class="p">.</span><span class="n">Layers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>A few things to note here:</p>

<ul>
<li>Setting the <code>MapOverlay.PositionOrigin</code> is the point in your overlays content you would like centered on the <code>GeoCoordinate</code>. The overlay has (0,0) as top left, and (1,1) as bottom right of your content. Since we&#8217;re using the old Pushpin image, we want (0,1) for bottom left. If (for example) you had an arrow pointing from left-to-right and you wanted the tip of the arrow to be pointing at the location, you would specify <code>overlay.PositionOrigin = new Point(1, 0.5);</code> for the center of the right-hand side.</li>
<li>A Map can have multiple <code>MapLayer</code>s</li>
<li>A <code>MapLayer</code> can have multiple <code>MapOverlay</code>s</li>
<li>We have to specify the <code>GeoCoordinate</code> property twice - once for the <code>Pushpin</code> itself, and once for the <code>MapOverlay</code> it&#8217;s going into.</li>
</ul>


<p>If you&#8217;re adding multiple pins simultaneously, you may want to add them in separate layers or on the same layer. I&#8217;ve opted for inserting all pins on the same layer, as I&#8217;ve found this exhibits the same behaviour I was experiencing previously - pins added later appear on top - so I&#8217;ve found no reason to experiment.</p>

<p>For further reading, check out the <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj207045(v=vs.105).aspx">Windows Phone Dev Center</a>.</p>

<h3>Maps API Key</h3>

<p>You may have noticed earlier that you no longer specify the <code>CredentialsProvider</code> in the XAML. Instead we have an event handler for the <code>Loaded</code> event on the map. As <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj207033(v=vs.105).aspx#BKMK_appidandtoken">detailed on MSDN</a> we now specify an ApplicationID and AuthenticationToken in code. This looks to be very simple, though I haven&#8217;t tried it yet (as you get the ApplicationID and AuthenticationToken during the app submission process).</p>

<figure class='code'><figcaption><span>Map.Loaded Event Handler</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">QuakeMap_Loaded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Microsoft</span><span class="p">.</span><span class="n">Phone</span><span class="p">.</span><span class="n">Maps</span><span class="p">.</span><span class="n">MapsSettings</span><span class="p">.</span><span class="n">ApplicationContext</span><span class="p">.</span><span class="n">ApplicationId</span> <span class="p">=</span> <span class="s">&quot;ApplicationID&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">Microsoft</span><span class="p">.</span><span class="n">Phone</span><span class="p">.</span><span class="n">Maps</span><span class="p">.</span><span class="n">MapsSettings</span><span class="p">.</span><span class="n">ApplicationContext</span><span class="p">.</span><span class="n">AuthenticationToken</span> <span class="p">=</span> <span class="s">&quot;AuthenticationToken&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-08T11:07:00-08:00" pubdate data-updated="true">Dec 8<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/windows-phone/'>windows-phone</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2019

    Adam

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-34453006-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>